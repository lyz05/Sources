const	maxc=50000;maxn=1000001;
var	n,c,tail,head,i:longint;
	s:array[1..maxn] of longint;
	q:array[1..maxc] of longint;
	a:array[1..maxn,1..2] of longint;
	dir,empty:boolean;
function next(x:longint):longint;
begin
	if dir then next:=(x mod c) + 1
	else next:=(x+c-2) mod c + 1;
end;
function front(x:longint):longint;
begin
	if dir then front:=(x+c-2) mod c +1
	else front:=(x mod c)+1;
end;
procedure push(num:longint);
begin
	//read(num);
	if (next(head) = tail) then begin
		inc(n);
		s[n]:=q[tail];
		tail:=next(tail);
	end;
	if empty then 
		empty:=false
	else	head:=next(head);
	q[head]:=num;
end;
procedure pop;
begin
	if empty then begin
		writeln('Error: the stack is empty!');
		exit;
	end;
	writeln(q[head]);
	if tail=head then empty:=true
	else begin
		head:=front(head);
		if n>0 then begin
			tail:=front(tail);
			q[tail]:=s[n];
			dec(n);
		end;
	end;
end;
procedure reserse;
var	tmp:longint;
begin
	if next(head) = tail then begin
		dir:=not dir;
		tmp:=head;
		head:=tail;
		tail:=tmp;
	end else writeln('Error: less than ',c,' elements in the stack!');
end;
begin
	assign(input,'3475.in');reset(input);

	readln(c);
	n:=0;
	tail:=1;
	head:=1;
	empty:=true;
	dir:=true;
	
	i:=1;
	read(a[i,1]);
	while a[i,1]<>0 do begin
		if a[i,1]=1 then read(a[i,2]);
		inc(i);
		read(a[i,1]);
	end;
	i:=1;
	while a[i,1]<>0 do begin
		case a[i,1] of
			1:push(a[i,2]);
			2:pop;
			3:reserse;
		end;
		inc(i);
	end;
end.
